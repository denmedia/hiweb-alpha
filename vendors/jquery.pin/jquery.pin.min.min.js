(function(a){a.fn.pin=function(e){var j=0,g=[],d=false,f=a(window);e=e||{};var h=function(){for(var t=0,r=g.length;t<r;t++){var m=g[t];if(e.minWidth&&f.width()<=e.minWidth){if(m.parent().is(".pin-wrapper")){m.unwrap()}m.css({width:"",left:"",top:"",position:""});if(e.activeClass){m.removeClass(e.activeClass)}d=true;continue}else{d=false}var k=e.containerSelector?m.closest(e.containerSelector):a(document.body);var q=m.offset();var i=k.offset();var s=m.offsetParent().offset();if(!m.parent().is(".pin-wrapper")){m.wrap("<div class='pin-wrapper'>")}var p=a.extend({top:0,bottom:0},e.padding||{});m.data("pin",{pad:p,from:(e.containerSelector?i.top:q.top)-p.top,to:i.top+k.height()-m.outerHeight()-p.bottom,end:i.top+k.height(),parentTop:s.top});m.css({width:m.outerWidth()});m.parent().css("height",m.outerHeight())}};var c=function(){if(d){return}j=f.scrollTop();var q=[];for(var m=0,k=g.length;m<k;m++){var p=a(g[m]),i=p.data("pin");if(!i){continue}q.push(p);var r=i.from-i.pad.bottom,n=i.to-i.pad.top;if(r+p.outerHeight()>i.end){p.css("position","");continue}if(r<j&&n>j){!(p.css("position")=="fixed")&&p.css({left:p.offset().left,top:i.pad.top}).css("position","fixed");if(e.activeClass){p.addClass(e.activeClass)}}else{if(j>=n){p.css({left:"",top:n-i.parentTop+i.pad.top}).css("position","absolute");if(e.activeClass){p.addClass(e.activeClass)}}else{p.css({position:"",top:"",left:""});if(e.activeClass){p.removeClass(e.activeClass)}}}}g=q};var b=function(){h();c()};this.each(function(){var i=a(this),k=a(this).data("pin")||{};if(k&&k.update){return}g.push(i);a("img",this).one("load",h);k.update=b;a(this).data("pin",k)});f.scroll(c);f.resize(function(){h()});h();f.load(b);return this}})(jQuery);